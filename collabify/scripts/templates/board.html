<!DOCTYPE html>
<html lang = "en">
<meta charset="utf-8">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Exo+2" rel="stylesheet">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <!--idk if these are used-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- Jquery Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script> 
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    {% load static %}

<!--JavaScript file for all things task-->
<script src="{% static 'js/tasks.js' %}"></script>

<!--Task Creation Modal css-->
<style>
/*
button {
    background-color: #4CAF50;
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
}
/*
button:hover {
    opacity: 0.8;
}

/* Extra styles for the cancel button */
body{
  font-size: 18px;
  padding: 2px;
}
.cancelbtn {
    width: auto;
    padding: 10px 18px;
    background-color: #f44336;
}

/* position the top of the dialog box */
.testing {
    padding: 16px;
}

span.psw {
    float: right;
    padding-top: 16px;
}

/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    padding-top: 60px;
}
  /* Modal Content/Box */
.modal-content {
    background-color: #fefefe;
    margin: 5% auto 15% auto; /* 5% from the top, 15% from the bottom and centered */
    border: 1px solid #888;
    width: 40%; /* Could be more or less, depending on screen size */
}

/* The Close Button (x) */
.closer {
    position: absolute;
    right: 25px;
    top: 0;
    color: #000;
    font-size: 35px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: red;
    cursor: pointer;
}

/* Add Zoom Animation */
.animate {
    -webkit-animation: animatezoom 0.6s;
    animation: animatezoom 0.6s
}

@-webkit-keyframes animatezoom {
    from {-webkit-transform: scale(0)} 
    to {-webkit-transform: scale(1)}
}
    
@keyframes animatezoom {
    from {transform: scale(0)} 
    to {transform: scale(1)}
}

/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
    span.psw {
       display: block;
       float: none;
    }
    .cancelbtn {
       width: 100%;
    }
}
</style>


<!--Breadcrumb css-->
<style>
ul.breadcrumb {
    padding: 10px 16px;
    list-style: none;
    background-color: #333;
}
ul.breadcrumb li {
    display: inline;
    font-size: 18px;
}
ul.breadcrumb li+li:before {
    padding: 8px;
    color: black;
    content: "/\00a0";
}
ul.breadcrumb li a {
    color: #0275d8;
    text-decoration: none;
}
ul.breadcrumb li a:hover {
    color: #01447e;
    text-decoration: underline;
}
</style>

<!-- Drag and Drop Scripts -->
<script>

function show_hide(id) {
  var deletionCheck = id.slice(0,1);

  if(deletionCheck == "d"){
    var parsedShowID = id.slice(5);
    console.log(parsedShowID);
  } else {
    var parsedShowID = id.slice(5);
    console.log(parsedShowID);
  }  
    
  dv = document.getElementById("collapse" + parsedShowID);
  ele = document.getElementById(id);

  if (dv.style.display ==  '')
    { 
      dv.style.display = 'none'; 
      ele.innerHTML = "Show";
    }
    else
    {
      dv.style.display = ''; 
      ele.innerHTML = "Hide";
    }
}


//task movability functions

function allowDrop(ev) {
    ev.preventDefault();
}

function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("text");
    ev.target.appendChild(document.getElementById(data));
}


</script>


<!--This style affects the board itself. We need to update this so that the different columns do not stack up on each other when the screen gets small. I also added in a fourth column so I might need to edit the size of each column-->
<style>
    /* divCategory affects the columns of the board */
    .divCategory{
        width: 250px;
        height: auto;
        padding: 10px;
        padding-bottom: 50px;
        border: 1px solid black;
    }

    .column{
      width: 25%;
      float: left;
      height: auto;
      padding-bottom: 50px;
      padding:auto;
      text-align: center;
      border: 1px solid black;
    }

    /* There are two #cloneheres, need to figure out which one is used */
    #clonehere{
        width: 350px;
        height: 500px;
        padding: 10px;
        float: left;
    }
    .divCategoryHeadParagraph{
        text-align: center;
        vertical-align: middle;
        color: white
    }
    .task{
        background-color: red;

        width: 350px;
        height: 50px;
    }
    .taskName{
      padding-top: 4px;
      padding-bottom: 3px;
    }
    .percentageBar{
      padding-top: 3px;
    }
    #clonehere{
      width: 350px;
      height: 200px;
    }

</style>

<style>
    label, input { 
      display:block; 
    }

    .well-header{
      background-color:black;
    }
  
    input.text { 
      margin-bottom:12px; width:95%; padding: .4em; 
    }
    fieldset { 
      padding:0; border:0; margin-top:25px; 
    }
    h1 { 
      font-size: 1.2em; margin: .6em 0; 
    }

    /*Prevents unwanted close button from showing in dialog*/
    .ui-dialog-titlebar-close {
    visibility: hidden;
}

</style>


<script>
       $(function() {
 
    var dialog, 
      form,
      name = $( "#taskName" ),
      priority = $( "#priorityLevel" ),
      percentage = $( "#percentageDone" ),
      assigned = $( "#assignedTo" ),
      allFields = $( [] ).add( name ).add( percentage ).add( priority ).add( assigned ),
      tips = $( ".validateTips" );
 
    var radios = document.getElementsByName('priorityLevel');
    for (var i = 0, length = radios.length; i < length; i++){
      if (radios[i].checked) {
        priority = radios[i].value;
        break;
      }
    }

    function updateTips( t ) { 
        tips.text( t ).addClass( "ui-state-highlight" );
        setTimeout(function() {
          tips.removeClass( "ui-state-highlight", 1500 );
        }, 500 );
    }
 
    function checkLength( o, n, min, max ) {
      if ( o.val().length > max || o.val().length < min ) {
        o.addClass( "ui-state-error" );
        updateTips( "Length of " + n + " must be between " +
          min + " and " + max + " characters." );
        return false;
      } else {
        return true;
      }
    }
 
    function checkRegexp( o, regexp, n ) {
      if ( !( regexp.test( o.val() ) ) ) {
        o.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    }
 
    function addTask() {
      console.log("called add task");
      var createdTask = new Task(name.val(), percentage.val(), priority, assigned.val());

        if(priority == 0){
            var newTask = LowPrioTaskMachine(createdTask.id);
            displayLowTask(createdTask);
            console.log("priority=0");
        } else if (priority == 1) {
            var newTask = MediumPrioTaskMachine(createdTask.id);
            displayMediumTask(createdTask);
        } else {
            var newTask = HighPrioTaskMachine(createdTask.id);
            displayHighTask(createdTask);
        }
  
        console.log(createdTask.id);

    }
    
    function createTask() {

      var radios = document.getElementsByName('priorityLevel');
      for (var i = 0, length = radios.length; i < length; i++){
        if (radios[i].checked) {
          priority = radios[i].value;
          break;
        }
      }
      var valid = true;
      allFields.removeClass( "ui-state-error" );
      valid = valid && checkLength( name, "task name", 1, 30 );
      valid = valid && checkLength( percentage, "percentage", 1, 2 );
      valid = valid && checkLength( assigned, "worker's name(s)", 1, 30 );
      valid = valid && checkRegexp( name, /([0-9a-z_\s])+$/i, "Task name may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );
      valid = valid && checkRegexp( percentage, /([0-9])+$/i, "Starting Perent must be an integer from 1 to 100" );
      valid = valid && checkRegexp( assigned, /([0-9a-z_\s])+$/i, "Name of worker task is assigned to. field may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );

      if ( valid ) {
        var createdTask = new Task(name.val(), percentage.val(), priority, assigned.val());
        if(priority == 0){
            var newTask = LowPrioTaskMachine(createdTask.id);
            displayLowTask(createdTask);
        } else if (priority == 1) {
            var newTask = MediumPrioTaskMachine(createdTask.id);
            displayMediumTask(createdTask);
        } else {
            var newTask = HighPrioTaskMachine(createdTask.id);
            displayHighTask(createdTask);
        }
  


        //dialog.dialog( "close" );
      }
      return valid;
  }
  $(function(){
    $('#clickme').click(function(){
         createTask();  //this will call your function
         dialog.dialog("close");
    });
  });
  $(function(){
     $('#closeme').click(function(){
         dialog.dialog("close");  //this will call your function
    });
 });
  $(function(){
     $('#openme').click(function(){
         dialog.dialog("open");  //this will call your function
    });
 });
  // Get the modal
var modal = document.getElementById('dialog-form');

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        dialog.dialog("close");
    }
}


    dialog = $( "#dialog-form" ).dialog({
      autoOpen: false,
      modal: true,

    close: function() {
        form[ 0 ].reset();
        allFields.removeClass( "ui-state-error" );
    }
    });
  
    form = dialog.find( "form" ).on( "submit", function( event ) {
      event.preventDefault();
      //addTask();
    });
 
    $( "#create-user" ).button().on( "click", function() {
      dialog.dialog( "open" ); 
    });
  });

  function remove(id) { 
    document.getElementById(id).parentElement.parentElement.outerHTML = ""; 
  }
</script>

</head>
<body>
<!--Breadcrumbs-->
<ul class="breadcrumb">
  <li><a href="#">Home</a></li>
  <li><a href="#">Pictures</a></li>
  <li><a href="#">Summer 15</a></li>
  <li style="color: white">Italy</li>
</ul>

<br>

<button type="button" id="create-user">Create New Task</button>

<!-- Task Creation Modal -->

<div id="dialog-form" class="modal">
  
  <form class="modal-content animate">
    <span onclick="document.getElementById('dialog-form').style.display='none'" id="closeme" class="close closer" title="Close Modal">&times;</span>
    
    <form>
    <fieldset>
    <div class="container testing">
      <div>
        
          <label for="taskName"><b>Task Name</b></label>
          <form method="POST">
            <input type="text" required placeholder="Enter Task Name" name="taskName" id="taskName">
        </form>
      </div>
      <br>
      <form method ="POST">
      <fieldset for="priorityLevel" id="priorityField" class="text ui-widget-content ui-corner-all">
      <label><Strong>Priority Level:</Strong></label>
         <label>High 
            <input style="float: left;" required type="radio" name="priorityLevel" id="priorityLevel" value="2"> 
         </label>
         <label>Medium 
            <input style="float: left;" required type="radio" name="priorityLevel" id="priorityLevel" value="1">
         </label>
         <label>Low 
           <input style="float: left;" required  type="radio" name="priorityLevel" id="priorityLevel" value="0" checked>
         </label>
       </fieldset>
      </form>
      <label for="percentageDone"><strong>Starting Percent</strong></label>
      <form method="POST">
      <input type="text" required  name="percentageDone" id="percentageDone" placeholder="10" class="text ui-widget-content ui-corner-all">
      </form>
  <br>
    
      <label for="assignedTo"><strong>Assigned to</strong></label>
      <form method="POST">
      <input type="text" required  name="assignedTo" id="assignedTo" placeholder="Bob" class="text ui-widget-content ui-corner-all">
      </form>
      <div class="container" align="center">
      <button type="button" id="clickme" style="width:auto;">Create Task</button>
      </div>

      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">

    </fieldset>
    </div>
  </form>
</div>

<!--
<div id="dialog-form" title="Create a New Task"> 
  <p class="validateTips">All form fields are required.</p>
 
  <form>
    <fieldset>
      <label for="taskName"><strong>Task Name</strong></label>
      <input type="text" required name="taskName" id="taskName" placeholder="eg: Refactor Code XYZ" class="text ui-widget-content ui-corner-all">


      <fieldset for="priorityLevel" id="priorityField" class="text ui-widget-content ui-corner-all">
      <p><strong>Priority Level:</strong></p>
         <label>High 
            <input style="float: left;" required type="radio" name="priorityLevel" id="priorityLevel" value="2"> 
         </label>
         <label>Medium 
            <input style="float: left;" required type="radio" name="priorityLevel" id="priorityLevel" value="1">
         </label>
         <label>Low 
           <input style="float: left;" required  type="radio" name="priorityLevel" id="priorityLevel" value="0" checked>
         </label>
         <br>
      </fieldset>

      <label for="percentageDone"><strong>Starting Percent</strong></label>
      <input type="text" required  name="percentageDone" id="percentageDone" placeholder="10" class="text ui-widget-content ui-corner-all">
 
    
      <label for="assignedTo"><strong>Assigned to</strong></label>
      <input type="text" required  name="assignedTo" id="assignedTo" placeholder="Bob" class="text ui-widget-content ui-corner-all">
 
      <-- Allow form submission with keyboard without duplicating the dialog button ->
      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </fieldset>
  </form>
</div>
-->
<!-- Kanban Board Skeleton -->
<div style="width:100%; overflow: hidden; padding-top: 25px;">  
  <div class="column" ondrop="drop(event)" ondragover="allowDrop(event)">
    <div class="container bg-warning rounded">
      <p class="divCategoryHeadParagraph"><strong>BackLog</strong></p>
    </div>
  </div>
  <div class="column" ondrop="drop(event)" ondragover="allowDrop(event)">
    <div class="container bg-info rounded">
      <p class="divCategoryHeadParagraph"><strong>Today</strong></p>
    </div>
  </div>
  <div class="column" ondrop="drop(event)" ondragover="allowDrop(event)">
    <div class="container bg-info rounded">
      <p class="divCategoryHeadParagraph"><strong>Current</strong></p>
      <!--Possibly use developing instead of current?-->
    </div>
  </div>
  <div class="column" ondrop="drop(event)" ondragover="allowDrop(event)">
    <div class="container bg-success rounded">
      <p class="divCategoryHeadParagraph"><strong>Finished</strong></p>
    </div>
  </div>
</div>


<!-- Low Prio Task Demo -->
<div class="LowPrioityTask" style="display: none;" id="dragL0" draggable="true" ondragstart="drag(event)">
  <header class="w3-blue taskName" id="lowHeader">
    <h1 style="display:inline;">Task Name</h1>
    <button  type="button" class="close" aria-label="Close" style="float:right;" id="delete-low0" onclick="remove(this.id)">  X  </button>
    <a onclick="show_hide(this.id)" style="cursor:pointer; text-decoration:underline; float: right;" id="showLow0">Hide</a>
  </header> 
  <div id="collapseLow0">
    <div class="w3-container">
      <div class="w3-light-grey w3-round">
        
        <p><strong>Progress: </strong></p>
        
        <div class="w3-light-blue w3-center" id="Bar" style="width:12%">12%</div>
      </div> 
    <div class="container" align="center">
    <br>
      <button type="button" class="btn btn-dark rounded" onclick="move(this.id)">Complete</button> 
    <br>
    <br>
    </div>
    </div>
    <footer class="w3-blue" id="lowFooter">
      <h5>worker</h5>
    </footer>
  </div>
</div>

<div id="clonehere"></div>

</body>
